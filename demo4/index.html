
<html>
 <head>
        <meta charset="utf-8">  
        <title>Circle - Partition</title>  
  </head> 

<style>
	body{
		background-color: #1E1E1E;
	}
</style>
<body>
<script src="/d3.v3.min.js"></script>
<script>

var width = 450,
    height = 450,
	radius =  Math.min(width, height) / 2 ;
	
var svg = d3.select("body").append("svg")
			.attr("width", width)
			.attr("height", height)
			.append("g")
			.attr("transform", "translate(" + radius + "," + radius + ")");

var partition = d3.layout.partition()
				.sort(null)
				.size([2 * Math.PI, radius * radius])
				.value(function(d) { return 1; });

				
var arc = d3.svg.arc()
			.startAngle(function(d) { return d.x; })
			.endAngle(function(d) { return d.x + d.dx; })
			.innerRadius(function(d) { return Math.sqrt(d.y); })
			.outerRadius(function(d) { return Math.sqrt(d.y + d.dy); });


d3.json("eufa.json", function(error, root) {

	if(error)
		console.log(error);
	console.log(root);

	var nodes = partition.nodes(root);

	var links = partition.links(nodes);


	console.log(nodes);
	//console.log(svg.selectAll("g"),"1");
	var arcs = svg.selectAll("g")
				  .data(nodes)
				  .enter().append("g")
				  .attr("class",function(d,i){
			return (d.className ? d.className: i);
		});

	// var groups = svg.selectAll("g")
	// 				.data(groupNodes)
	// 				.enter().append("g")
	// 				.attr("class",function(d){
	// 					return ".group-team ";
	// 				});

	// var team = groups.append("g")
	// 				 .attr()

	
	arcs.append("path")
		.attr("display", function(d) {console.log(d.depth); return d.depth ? null : "none"; }) // hide inner ring
		.attr("d", arc)
		.style("stroke", "rgb(202, 202, 202)")
		.style("fill", function(d) { return (d.color ? d.color: "#aaa"); });
		// .on("mouseover",function(d){
		// 	d3.select(this)
		// 		.transition()
		// 		.duration(500)
		// 		.style("fill","yellow");
		// })
		// .on("mouseout",function(d){
		// 	d3.select(this)
		// 		.transition()
		// 		.duration(500)
		// 		.style("fill", function(d) { 
		// 			return (d.color ? d.color: "#aaa");
		// 		});
		// });

	var teams = svg.selectAll('.team')
				   .style("opacity","0.15")
				   .on("mouseover",function(d){
				   		d3.select(this)
				   		  .transition()
				   		  .duration(300)
				   		  .style("opacity",0.5)
				   })
				   .on("mouseout",function(d){
				   		d3.select(this)
				   		  .transition()
				   		  .duration(300)
				   		  .style("opacity",0.15)
				   });

	var groups = svg.selectAll(".group")
					.on("mouseover",function(d){
						var hoverGroup = this;
						//console.log('123');
						d3.selectAll(".group")
						  .transition()
						  .style("opacity",function(){
						  	return (this === hoverGroup)? 1 : 0.3;
						  })
					})

				  
	arcs.append("text")  
		.style("font-size", "13px")
		.style("font-family", "simsun")
		.attr("text-anchor","middle")
		.attr("transform",function(d,i){
				//第一个元素（最中间的），只平移不旋转
				if( i == 0 )
					return "translate(" + 0 + ")";
				
				//其他的元素，既平移也旋转
				var r = 0;
				var dgr = (d.x + d.dx/2)/ Math.PI*180;
				//console.log(dgr,d.x);
				// if( (d.x+d.dx/2)/Math.PI*180 < 180 )  // 0 - 180 度以内的
				// 	r = 180 * ((d.x + d.dx / 2 - Math.PI / 2) / Math.PI);
				// else  // 180 - 360 度以内的
				// 	r = 180 * ((d.x + d.dx / 2 + Math.PI / 2) / Math.PI);


				if (  dgr >90 && dgr <= 270 )
					r = dgr - 180;
				else
					r = dgr;
					
				//既平移也旋转
				return  "translate(" + arc.centroid(d) + ")" +
						"rotate(" + r + ")";

		}) 
		.text(function(d) { return d.name; });

	// arcs.append("image")
	// 	.attr("width", 20)
	// 	.attr("height", 20)
	// 	.attr("opacity",1)
	// 	.attr("transform",function(d,i){
	// 		if (i == 0)
	// 			return "translate(" + 0 + ")";

	// 		var r = 0;
	// 		var dgr = (d.x + d.dx/2)/ Math.PI*180;
	// 		if (dgr > 90 && dgr <= 270) 
	// 			r = dgr - 180;
	// 		else
	// 			r = dgr;

	// 		return "translate(" + arc.centroid(d) + ")" +
	// 			   "rotate(" + r + ")";
	// 	})
	// 	.attr("xlink:href",function(d){
	// 		return (d.img ? d.img : "http://www.oneapm.com/logo.png")
	// 	});


  
});

</script>
		
    </body>  
</html>  
